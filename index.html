<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous - Mensagens An√¥nimas</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üë§</text></svg>">
</head>
<body>
    <div class="container">
        <div class="phone-frame">
            <!-- P√°gina de envio de mensagem (quando tem par√¢metro ?u=) -->
            <div id="sendPage" style="display: none;">
                <div class="header">
                    <div class="icon">üë§</div>
                    <h1>Anonymous</h1>
                    <p id="targetUser">Envie uma mensagem an√¥nima</p>
                </div>
                
                <form id="messageForm">
                    <div class="form-group">
                        <label for="message">Sua mensagem an√¥nima</label>
                        <textarea id="message" name="message" required 
                                  placeholder="Digite sua mensagem aqui..." 
                                  maxlength="500" rows="6"></textarea>
                        <div style="text-align: right; font-size: 12px; color: #888; margin-top: 5px;">
                            <span id="charCount">0</span>/500 caracteres
                        </div>
                    </div>
                    
                    <!-- Captcha simples -->
                    <div class="form-group">
                        <label>Verifica√ß√£o (some os n√∫meros):</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span id="captchaQuestion" style="color: #FFD700; font-size: 18px; font-weight: 600;"></span>
                            <input type="number" id="captchaAnswer" required 
                                   style="width: 80px;" placeholder="?">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-primary" id="submitBtn">
                        Enviar Mensagem
                    </button>
                </form>
                
                <div class="warning">
                    <strong>üîí Privacidade:</strong> Sua mensagem ser√° enviada de forma completamente an√¥nima. O destinat√°rio n√£o saber√° quem enviou.
                </div>
                
                <a href="javascript:showHomePage()" class="back-link">‚Üê Voltar ao in√≠cio</a>
            </div>

            <!-- P√°gina inicial (quando n√£o tem par√¢metros) -->
            <div id="homePage">
                <div class="header">
                    <div class="icon">üë§</div>
                    <h1>Anonymous</h1>
                </div>
                
                <div class="hero">
                    <h2>100% An√¥nimo</h2>
                    <p>Receba mensagens completamente an√¥nimas</p>
                </div>
                
                <div class="features">
                    <div class="feature">
                        <span class="feature-icon">‚ö°</span>
                        <h3>R√°pido e F√°cil</h3>
                        <p>Configure em segundos</p>
                    </div>
                    
                    <div class="feature">
                        <span class="feature-icon">üíé</span>
                        <h3>Premium Experience</h3>
                        <p>Interface elegante e funcionalidades avan√ßadas</p>
                    </div>
                </div>
                
                <div class="how-it-works">
                    <h3>Como Funciona</h3>
                    <div class="steps">
                        <div class="step">
                            <span class="step-number">1</span>
                            <p>Crie sua conta e compartilhe seu link</p>
                        </div>
                        <div class="step">
                            <span class="step-number">2</span>
                            <p>Receba mensagens an√¥nimas</p>
                        </div>
                    </div>
                </div>
                
                <div class="cta-buttons">
                    <button class="btn-primary" onclick="window.location.href='register.html'">
                        Criar Conta
                    </button>
                    <button class="btn-secondary" onclick="window.location.href='login.html'">
                        Entrar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de sucesso -->
    <div class="modal" id="successModal">
        <div class="modal-content" style="text-align: center;">
            <div style="font-size: 48px; margin-bottom: 20px;">‚úÖ</div>
            <h3 style="color: #28a745; margin-bottom: 15px;">Mensagem Enviada!</h3>
            <p style="color: #cccccc; margin-bottom: 25px;">
                Sua mensagem an√¥nima foi enviada com sucesso!
            </p>
            
            <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 25px;">
                <p style="color: #FFD700; font-weight: 600; margin-bottom: 10px;">
                    Quer receber mensagens tamb√©m?
                </p>
                <p style="color: #cccccc; font-size: 14px;">
                    Crie sua conta e comece a receber mensagens an√¥nimas!
                </p>
            </div>
            
            <div style="display: grid; gap: 10px;">
                <button class="btn-primary" onclick="window.location.href='register.html'">
                    Criar Minha Conta
                </button>
                <button class="btn-secondary" onclick="closeSuccessModal()">
                    Fechar
                </button>
            </div>
        </div>
    </div>
    
    <script src="app.js"></script>
    <script src="animations.js"></script>
    <script>
        let targetSlug = null;
        let captchaAnswer = 0;
        
        // Verificar se √© p√°gina de envio ou home
        function checkPageType() {
            const userSlug = Utils.getUrlParameter('u');
            
            if (userSlug) {
                // Mostrar p√°gina de envio
                targetSlug = userSlug;
                showSendPage();
            } else {
                // Mostrar p√°gina inicial
                showHomePage();
            }
        }
        
        function showSendPage() {
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('sendPage').style.display = 'block';
            
            // Verificar se usu√°rio existe
            if (!checkUserExists(targetSlug)) {
                return;
            }
            
            // Configurar p√°gina
            generateCaptcha();
            setupCharCounter();
            
            // Atualizar t√≠tulo
            document.title = `Enviar mensagem para ${targetSlug} - Anonymous`;
        }
        
        function showHomePage() {
            document.getElementById('sendPage').style.display = 'none';
            document.getElementById('homePage').style.display = 'block';
            document.title = 'Anonymous - Mensagens An√¥nimas';
            
            // Limpar URL
            if (window.location.search) {
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }
        
        // Verificar se usu√°rio existe
        function checkUserExists(slug) {
            const user = UserManager.getUserBySlug(slug);
            
            if (user) {
                document.getElementById('targetUser').textContent = 
                    `Envie uma mensagem an√¥nima para ${user.username}`;
                return true;
            } else {
                document.getElementById('targetUser').innerHTML = 
                    '<span style="color: #dc3545;">Usu√°rio n√£o encontrado</span>';
                document.getElementById('messageForm').style.display = 'none';
                return false;
            }
        }
        
        // Gerar captcha simples
        function generateCaptcha() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            captchaAnswer = num1 + num2;
            document.getElementById('captchaQuestion').textContent = `${num1} + ${num2} =`;
        }
        
        // Contador de caracteres
        function setupCharCounter() {
            const textarea = document.getElementById('message');
            const charCount = document.getElementById('charCount');
            
            if (!textarea || !charCount) return;
            
            textarea.addEventListener('input', function() {
                const count = this.value.length;
                charCount.textContent = count;
                
                if (count > 450) {
                    charCount.style.color = '#dc3545';
                } else if (count > 400) {
                    charCount.style.color = '#ffc107';
                } else {
                    charCount.style.color = '#888';
                }
            });
        }
        
        // Enviar mensagem
        document.addEventListener('DOMContentLoaded', function() {
            const messageForm = document.getElementById('messageForm');
            if (messageForm) {
                messageForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const submitBtn = document.getElementById('submitBtn');
                    const originalText = submitBtn.textContent;
                    
                    try {
                        const message = document.getElementById('message').value.trim();
                        const userCaptcha = parseInt(document.getElementById('captchaAnswer').value);
                        
                        // Valida√ß√µes
                        if (!message) {
                            throw new Error('Mensagem n√£o pode estar vazia');
                        }
                        
                        if (message.length > 500) {
                            throw new Error('Mensagem muito longa (m√°ximo 500 caracteres)');
                        }
                        
                        if (userCaptcha !== captchaAnswer) {
                            throw new Error('Verifica√ß√£o incorreta. Tente novamente.');
                        }
                        
                        submitBtn.innerHTML = '<span class="loading"></span> Enviando...';
                        submitBtn.disabled = true;
                        
                        // Enviar mensagem
                        MessageManager.sendMessage(targetSlug, message);
                        
                        // Mostrar modal de sucesso ap√≥s 1.5s
                        setTimeout(() => {
                            document.getElementById('successModal').classList.add('active');
                            
                            // Reset form
                            document.getElementById('messageForm').reset();
                            document.getElementById('charCount').textContent = '0';
                            generateCaptcha();
                            
                            submitBtn.textContent = originalText;
                            submitBtn.disabled = false;
                        }, 1500);
                        
                    } catch (error) {
                        Utils.showNotification(error.message, 'error');
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                        
                        // Regenerar captcha em caso de erro
                        generateCaptcha();
                        document.getElementById('captchaAnswer').value = '';
                    }
                });
            }
        });
        
        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }
        
        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            checkPageType();
            document.querySelector('.phone-frame').classList.add('fade-in');
        });
    </script>
</body>
</html>
